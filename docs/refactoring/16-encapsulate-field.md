## 简介

“封装字段”（Encapsulate Field）是一种常用的重构手法，通过把公有字段转变为私有字段，并配套提供对应的访问器（getter）与修改器（setter）方法，来强化代码的数据封装特性。这么做可以更为精细地把控外界对类内部数据的访问权限，提升代码的安全性与可维护性。接下来为大家介绍“封装字段”重构的详细步骤。

## 封装字段 (Encapsulate Field)的详细步骤

### 1. 识别需要封装的字段

- **公有字段查找**：遍历代码中的类，找出所有被声明为公有（public）的字段。公有字段能够被类外部的任何代码直接访问与修改，这可能带来潜在风险。
- **访问频率考量**：留意那些频繁被外部代码访问或者修改的公有字段，它们往往是封装的重点对象。虽然偶尔被外部访问的字段也可封装，但高频率访问的字段封装后能更快凸显安全性与可维护性提升。
- **数据敏感性评估**：识别那些包含敏感数据的公有字段，例如用户密码、财务数据相关的字段，这类字段必须封装，以防数据被不当篡改。

### 2. 将公有字段转为私有

- **修改访问修饰符**：把公有字段的访问修饰符从 `public` 更改为 `private`。如此一来，该字段就只能在类的内部被访问，外部代码无法直接触及。

### 3. 创建访问器（getter）和修改器（setter）方法

- **生成getter方法**：针对每个被封装的私有字段，创建一个公有的访问器方法，方法名通常以“get”开头，后面紧跟字段名（遵循命名规范，首字母大写），此方法用于返回字段的值，内部仅包含一条简单的
  `return` 语句，返回对应的私有字段。
- **生成setter方法**
  ：创建公有的修改器方法，名字常以“set”开头，后面紧跟字段名，方法接收一个参数，用于传入要设置给私有字段的值，在方法内部将传入值赋给对应的私有字段。需留意的是，对于一些有取值范围限制或者特殊校验逻辑的数据，可在
  `setter` 方法内添加相应的校验代码。

### 4. 更新外部代码引用

- **替换直接引用**：查找项目中所有对原公有字段的直接引用之处，把它们替换成调用对应的 `getter` 或 `setter`
  方法。现代集成开发环境（IDE）的查找替换功能在这一步能发挥很大作用，帮助快速定位所有引用点。

### 5. 测试

- **编译代码**：首先确保代码能顺利编译，不存在因访问权限变更、方法添加等操作引发的语法错误。
- **运行测试**：执行全部相关的单元测试，保证重构过程没有引入新的逻辑错误，原有功能依旧正常运作。
- **手动测试**：针对关键业务逻辑涉及到被封装字段读写的部分，如有必要开展手动测试，尤其是那些添加了校验逻辑的 `setter`
  方法，要手动验证校验是否生效。

### 6. 代码审查

- **同行评审**：邀请同事或团队中的其他成员来审查此次更改，从第三方视角审视代码质量是否因封装字段而得到提升，有没有遗漏更新的引用点，确保代码整体的可维护性。
- **文档更新**：如果项目有维护文档的习惯，及时更新相关文档内容，记录哪些字段被封装，以及新的访问与修改方式，方便后续开发者查阅。

## 示例

假设有一个简单的 `User` 类，包含公有字段：

---java
public class User {
public String name;
public int age;
}
---

### 步骤如下：

1. **识别需要封装的字段**：
    - 类 `User` 中的 `name` 和 `age` 字段均为公有字段，需要封装。
2. **将公有字段转为私有**：
    - 把 `name` 字段声明从 `public String name;` 修改为 `private String name;`，把 `age` 字段声明从 `public int age;` 修改为
      `private int age;`。
3. **创建访问器（getter）和修改器（setter）方法**：
    - 为 `name` 字段创建 `getter` 、`setter` 方法：
   ```java
   public String getName() {
       return name;
   }
   public void setName(String newName) {
        name = newName;
   }
   ```
    - 为 `name` 字段创建 `getter` 、`setter` 方法：
   ```java
   public int getAge() {
        return age;
   }
   public void setAge(int newAge) {
     age = newAge;
   }
   ```
### 4. 更新外部代码引用
假设有一处外部代码原本是 `User user = new User(); user.name = "John";`，需改为 `User user = new User(); user.setName("John");` ；原本的 `System.out.println(user.age);` 需改为 `System.out.println(user.getAge());`。

### 5. 测试
- **编译代码**：首先确保代码能顺利编译，不存在因访问权限变更、方法添加等操作引发的语法错误。
- **运行测试**：执行全部相关的单元测试，保证重构过程没有引入新的逻辑错误，原有功能依旧正常运作。
- **手动测试**：针对关键业务逻辑涉及到被封装字段读写的部分，如有必要开展手动测试，尤其是那些添加了校验逻辑的 `setter` 方法，要手动验证校验是否生效。

### 6. 代码审查
- **同行评审**：邀请同事或团队中的其他成员来审查此次更改，从第三方视角审视代码质量是否因封装字段而得到提升，有没有遗漏更新的引用点，确保代码整体的可维护性。
- **文档更新**：如果项目有维护文档的习惯，及时更新相关文档内容，记录哪些字段被封装，以及新的访问与修改方式，方便后续开发者查阅。

    
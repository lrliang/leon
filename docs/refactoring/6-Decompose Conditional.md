# 拆分条件表达式 (Decompose Conditional)

## 简介
“拆分条件表达式”是一项关键的重构技术，当代码里的条件语句变得繁杂冗长，嵌套层级过多时，它能派上大用场。借助这一手法，可把复杂的条件表达式拆解成多个简单、清晰的子条件，让代码逻辑一目了然，更易于后续的维护与拓展。

## 拆分条件表达式 (Decompose Conditional) 的详细步骤

### 1. 定位复杂条件表达式
- **查找长语句**：浏览代码，留意那些一眼看上去就占据多行，包含诸多逻辑运算符，像是“&&”“||”“!” 的 `if`、`else if` 这类条件语句，还有三元运算符组成的长表达式，它们往往就是需要处理的复杂条件。
- **发现嵌套结构**：特别关注存在多层嵌套的条件语句，内层条件依赖外层求值结果的那种。这种嵌套结构会让代码逻辑晦涩难懂，也是重点排查对象。

### 2. 提取子条件
- **拆分独立逻辑**：仔细剖析复杂条件，从中拎出相对独立的逻辑判断部分，将其封装成一个个单独的方法。每个新方法只需专注一项简单的条件判断，最后返回布尔值。
- **精准命名**：给新提取出来的方法起名字要格外用心，名称得有足够的描述性，让人一看就明白这个方法负责判断的具体内容。

### 3. 替换原条件表达式
- **简化主流程**：回到原先使用复杂条件表达式的代码位置，把那些冗长的条件，替换成对新提取方法的调用。如此一来，主流程代码不再被复杂条件充斥，逻辑线更加清爽。
- **维持逻辑顺序**：按照原条件原本的先后与嵌套顺序，依次调用新方法，以此保障整体逻辑没有变动。

### 4. 测试
- **编译检查**：先试着编译代码，确认提取方法、更替表达式这些操作，没有引发语法层面的错误。
- **单元测试验证**：运行跟这段代码相关的全部单元测试，由于只是拆分条件，没改变内在逻辑，正常情况下测试都应顺利通过；要是有测试失败，就得仔细排查拆分过程是否引入了逻辑漏洞。
- **回归测试兜底**：要是项目有更高层级的就开展回归测试，确保系统整体功能没受影响。

### 5. 代码审查
- **同行把关**：邀请同事来查看重构后的代码，重点检查新提取方法的逻辑是不是正确，整体代码可读性是不是真的提升了，有没有潜藏的维护隐患。
- **规范审查**：核实新方法的命名、参数设定、返回值等要素，是否遵循项目既定的编码规范。

## 示例
假设有如下一段代码，用来判断用户是否有权限访问特定资源：
```java
public class UserAccess {
    private boolean isAdmin;
    private boolean hasPermission;
    private int userLevel;

    public boolean canAccessResource() {
        return (isAdmin || (hasPermission && userLevel > 3)) && !isBlocked();
    }

    private boolean isBlocked() {
        // 一些判断用户是否被封禁的逻辑
        return false;
    }
}
```

### 步骤如下：
1. **定位复杂条件表达式**：
   - `canAccessResource` 方法中的返回条件 `(isAdmin || (hasPermission && userLevel > 3)) &&!isBlocked()` 较为复杂，是重构目标。
2. **提取子条件**：
   - 针对 `(isAdmin || (hasPermission && userLevel > 3))` 提取 `hasBasicAccess` 方法：
   ```java
     private boolean hasBasicAccess() {
        return isAdmin || (hasPermission && userLevel > 3);
     }
   ```
3. **替换原条件表达式**：
   ```java
   public boolean canAccessResource() {
       return hasBasicAccess() &&!isBlocked();
   }
   ```
4. **测试**：
   - **编译代码**：代码能正常编译，无语法错误。
   - **运行测试**：运行相关单元测试，所有测试用例通过，说明重构未引入新错误。
5. **代码审查**：
   - **同行评审**：同事审查后，认可新方法提升了代码可读性，逻辑无误。
   - **文档更新**：若项目有文档，更新相关部分说明此次重构改动。 